@model StempelApp.Viewmodels.KontaktViewModel

<section class="section">
    <div class="container">
        <h1 class="title">Kontaktdaten</h1>

        @if (Model == null)
        {
            <div class="notification is-danger">
                <strong>Fehler:</strong> Das Datenmodell konnte nicht geladen werden.
                Bitte prüfen Sie, ob der Controller <code>return View(model);</code> aufruft.
            </div>
        }
        else
        {
            <div class="tabs is-boxed">
                <ul>
                    <li class="is-active" data-target="staff-content">
                        <a>
                            <span class="icon is-small"><i class="fas fa-users"></i></span>
                            <span>Personal (@(Model.Mitarbeiter?.Count ?? 0))</span>
                        </a>
                    </li>
                    <li data-target="owner-content">
                        <a>
                            <span class="icon is-small"><i class="fas fa-building"></i></span>
                            <span>Immobilienbesitzer (@(Model.Immobilienbesitzer?.Count ?? 0))</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div id="tab-content">
                @* --- TAB: PERSONAL --- *@
                <div class="tab-pane" id="staff-content">
                    <div class="box">
                        <table class="table is-fullwidth is-striped is-hoverable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Rolle</th>
                                    <th>E-Mail</th>
                                    <th class="has-text-right">Aktionen</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.Mitarbeiter != null)
                                {
                                    @foreach (var m in Model.Mitarbeiter)
                                    {
                                        <tr>
                                            <td><strong>@m?.FirstName @m?.LastName</strong></td>
                                            <td><span class="tag is-info is-light">@m?.UserType</span></td>
                                            <td>@m?.ContactInfo?.Email</td>
                                            <td class="has-text-right">
                                                <div class="buttons is-right">
                                                    <a asp-action="EditMitarbeiter" asp-route-id="@m.Id" class="button is-small is-warning is-light" title="Bearbeiten">
                                                        <span class="icon is-small"><i class="fas fa-edit"></i></span>
                                                    </a>
                                                    <a asp-action="DeleteMitarbeiter" asp-route-id="@m.Id" class="button is-small is-danger is-light"
                                                       onclick="return confirm('Mitarbeiter wirklich löschen?');" title="Löschen">
                                                        <span class="icon is-small"><i class="fas fa-trash"></i></span>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>

                @* --- TAB: IMMOBILIENBESITZER --- *@
                <div class="tab-pane is-hidden" id="owner-content">
                    <div class="box">
                        <table class="table is-fullwidth is-striped is-hoverable">
                            <thead>
                                <tr>
                                    <th>Besitzer</th>
                                    <th>Projekte & Aktivitäten</th>
                                    <th>Kontakt</th>
                                    <th class="has-text-right">Aktionen</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.Immobilienbesitzer != null)
                                {
                                    @foreach (var c in Model.Immobilienbesitzer)
                                    {
                                        <tr>
                                            <td>
                                                <p class="title is-6">@c.User?.FirstName @c.User?.LastName</p>
                                                <p class="subtitle is-7">@@@c.User?.Username</p>
                                            </td>
                                            <td>
                                                @foreach (var p in c.Projects ?? new List<Project>())
                                                {
                                                    <div class="mb-3">
                                                        <p class="is-size-7 has-text-weight-bold">@p.CustomerName (@(p.Address?.City ?? "Keine Stadt"))</p>
                                                        <div class="tags">
                                                            @foreach (var act in p.Activities ?? new List<string>())
                                                            {
                                                                <span class="tag is-primary is-light">@act</span>
                                                            }
                                                        </div>
                                                    </div>
                                                }
                                            </td>
                                            <td>
                                                <a href="mailto:@c.User?.ContactInfo?.Email" class="is-size-7">@c.User?.ContactInfo?.Email</a>
                                            </td>
                                            <td class="has-text-right">
                                                <div class="buttons is-right">
                                                    <a asp-action="EditBesitzer" asp-route-id="@c.Id" class="button is-small is-info is-light" title="Bearbeiten">
                                                        <span class="icon is-small"><i class="fas fa-pen"></i></span>
                                                    </a>
                                                    <a asp-action="DeleteBesitzer" asp-route-id="@c.Id" class="button is-small is-danger is-light"
                                                       onclick="return confirm('Besitzer wirklich löschen?');" title="Löschen">
                                                        <span class="icon is-small"><i class="fas fa-trash"></i></span>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        }
    </div>
</section>

<script>
    document.querySelectorAll('.tabs li').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.tabs li').forEach(item => item.classList.remove('is-active'));
            tab.classList.add('is-active');

            const target = tab.dataset.target;
            document.querySelectorAll('.tab-pane').forEach(pane => {
                if (pane.id === target) {
                    pane.classList.remove('is-hidden');
                } else {
                    pane.classList.add('is-hidden');
                }
            });
        });
    });
</script>